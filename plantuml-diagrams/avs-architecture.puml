@startuml
skinparam componentStyle rectangle
skinparam backgroundColor white
skinparam handwritten false
skinparam ArrowColor black
skinparam ArrowThickness 1.5

title Evaluation AVS Architecture

package "Smart Contracts Layer" {
  [EvalAvsServiceManager] as ServiceManager
  [EvalAvsTaskManager] as TaskManager
  [BlsRegistryCoordinator] as BLSRegistry
  [StakeRegistry] as StakeRegistry
}

package "Operator Layer" {
  [Operator Service] as OpService
  [Operator CLI] as OpCLI
  [Task Queue] as TaskQueue
  [BLS Signing Module] as BlsSigner
  [Config Manager] as ConfigMgr
  
  component "Go Evaluator" as GoEval {
    [Model Client Factory] as ModelFactory
    [Response Scorer] as Scorer
    [Result Processor] as Processor
    [Metrics Collector] as Metrics
  }
}

package "Infrastructure Layer" {
  [Docker Container] as Docker
  [Monitoring Agent] as Monitor
  [Health Checker] as Health
  [Slashing Detector] as Slashing
}

cloud "External Services" {
  [EigenLayer Core] as EigenLayer
  [Dataset Registry (S3)] as S3
  [LLM API Providers] as LLM
  [LayerLens API] as LayerLensAPI
}

' Contract interactions
ServiceManager -right-> BLSRegistry
TaskManager -up-> ServiceManager
StakeRegistry -right-> ServiceManager
BLSRegistry -up-> EigenLayer
StakeRegistry -up-> EigenLayer

' Operator components
OpService -right-> TaskQueue
OpService -down-> BlsSigner
OpService -down-> ConfigMgr
OpService -right-> GoEval
OpCLI -down-> OpService
OpCLI -right-> ConfigMgr
ModelFactory -up-> LLM
GoEval -down-> Processor
GoEval -right-> Scorer
GoEval -up-> Metrics
Processor -right-> LayerLensAPI

' Infrastructure
Docker -right-> OpService
Monitor -right-> OpService
Monitor -down-> Health
Monitor -down-> Slashing
Slashing -up-> EigenLayer

' External connections
OpService -up-> TaskManager
OpService -up-> S3
TaskManager -right-> LayerLensAPI

@enduml