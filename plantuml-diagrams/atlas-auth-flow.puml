@startuml atlas-auth-flow

' Basic styling
!theme plain
skinparam backgroundColor white
skinparam defaultTextAlignment center

' Explicitly disable handwritten mode
skinparam handwritten false
skinparam shadowing false
skinparam roundCorner 0

' Force straight lines
skinparam linetype ortho
skinparam ParticipantPadding 20
skinparam SequenceBoxPadding 10

' Make sure lines and fonts are crisp
skinparam ArrowColor black
skinparam ArrowThickness 1.5

title User Authentication Flow

actor User
participant "Atlas Frontend" as Frontend
participant "Next Auth" as NextAuth
participant "Atlas API" as API
participant "AWS Cognito" as Cognito
participant "Database" as DB

note over User, DB: User Authentication Process

User -> Frontend: Login with email/password
activate Frontend
Frontend -> NextAuth: Submit credentials
NextAuth -> Cognito: Authenticate user
activate Cognito
Cognito --> NextAuth: Return JWT token
deactivate Cognito
NextAuth --> Frontend: Store auth token in session
Frontend --> User: Redirect to dashboard
deactivate Frontend

User -> Frontend: Access protected route
activate Frontend
Frontend -> API: Request data with auth token
activate API
API -> API: JWT middleware validates token
API -> Cognito: Verify token (if needed)
Cognito --> API: Token verification
API -> DB: Fetch authorized data
DB --> API: Return data
API --> Frontend: Return authorized data
deactivate API
Frontend --> User: Display content
deactivate Frontend
@enduml