@startuml
skinparam componentStyle rectangle
skinparam backgroundColor white
skinparam handwritten false
skinparam ArrowColor black
skinparam ArrowThickness 1.5

title LayerLens Atlas App Architecture

package "User Interface Layer" {
  [Atlas Web UI] as WebUI
  [Next.js App] as NextApp
  [Authentication Module] as Auth
  [Results Visualization] as Viz
}

package "API Layer" {
  [API Gateway] as ApiGw
  [Go Backend API] as GoBackend
  [WebSocket Service] as WebSocket
  [Rate Limiter] as RateLim
}

package "Core Services" {
  [Evaluation Manager] as EvalManager
  [Model Registry] as ModelRegistry
  [Dataset Manager] as DatasetManager
  [User Manager] as UserManager
  [Results Processor] as ResultsProcessor
}

package "Integration Layer" {
  [Evaluation Worker] as Worker
  [Smart Contract Client] as ContractClient
  [Metrics Collector] as MetricsCollector
}

package "Data Layer" {
  database "MongoDB" as MongoDB {
    [Evaluations] as MongoEvals
    [Users] as MongoUsers
    [Datasets] as MongoDsets
  }
  
  database "MariaDB" as MariaDB {
    [Aggregated Metrics] as MetricsDB
    [Historical Data] as HistoryDB
  }
  
  database "AWS S3" as S3 {
    [Results Storage] as ResultsS3
    [Dataset Files] as DatasetsS3
  }
  
  queue "Message Queue" as Queue
}

cloud "External Services" {
  [AWS Cognito] as Cognito
  [LayerLens AVS] as AVS
  [LLM Providers] as LLMs
}

' User interactions
WebUI -right-> NextApp
NextApp -down-> Auth
NextApp -down-> Viz
NextApp -right-> ApiGw

' API interactions
Auth -right-> Cognito
ApiGw -down-> GoBackend
ApiGw -down-> WebSocket
ApiGw -down-> RateLim

' Core service connections
GoBackend -down-> EvalManager
GoBackend -down-> ModelRegistry
GoBackend -down-> DatasetManager
GoBackend -down-> UserManager
GoBackend -down-> ResultsProcessor

' Data connections
EvalManager -down-> MongoEvals
ModelRegistry -down-> MongoEvals
DatasetManager -down-> MongoDsets
UserManager -down-> MongoUsers
ResultsProcessor -down-> MetricsDB
ResultsProcessor -down-> HistoryDB

' Integration connections
EvalManager -right-> Queue
Queue -right-> Worker
Worker -right-> ContractClient
Worker -down-> ResultsProcessor
ContractClient -right-> AVS
MetricsCollector -right-> LLMs
MetricsCollector -down-> MetricsDB

' Storage connections
DatasetManager -right-> DatasetsS3
ResultsProcessor -right-> ResultsS3

@enduml